<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Opening Trainer — Dutch & Vienna</title>
    <meta name="description" content="Playable opening trainer for Dutch Defense and Vienna Opening" />
    <style>
      :root { color-scheme: dark; }
      html, body, #root { height: 100%; }
      body { margin: 0; background: #0b1220; color: #e5e7eb; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, 'Apple Color Emoji', 'Segoe UI Emoji'; }
      button { cursor: pointer; } a { color: #93c5fd; }
    </style>
    <script async src="https://unpkg.com/es-module-shims@1.10.0/dist/es-module-shims.js"></script>
    <script type="importmap">
      {
        "imports": {
          "react": "https://cdn.jsdelivr.net/npm/react@18.2.0/+esm",
          "react-dom/client": "https://cdn.jsdelivr.net/npm/react-dom@18.2.0/client/+esm",
          "chess.js": "https://cdn.jsdelivr.net/npm/chess.js@1.0.0/+esm",
          "react-chessboard": "https://cdn.jsdelivr.net/npm/react-chessboard@latest/+esm"
        }
      }
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module">
      import React, { useEffect, useMemo, useRef, useState } from 'react';
      import { createRoot } from 'react-dom/client';
      import * as ChessJS from 'chess.js';
      import ChessboardPkg from 'react-chessboard';

      function resolveChessCtor(mod){
        const c = typeof mod === 'function' ? mod
          : (typeof mod?.Chess === 'function' ? mod.Chess
          : (typeof mod?.default === 'function' ? mod.default : null));
        return (typeof c === 'function') ? c : null;
      }
      function resolveChessboardComponent(mod){
        const d = (typeof mod === 'function') ? mod : null;
        const n = (typeof mod?.Chessboard === 'function') ? mod.Chessboard : null;
        return d || n || null;
      }
      const Chess = resolveChessCtor(ChessJS);
      const Chessboard = resolveChessboardComponent(ChessboardPkg);

      const stripChecks = (san) => san ? san.replace(/[+#]/g,'') : san;
      const isValidFenLike = (fen)=>{
        if(typeof fen!=='string')return false;
        const parts = fen.trim().split(/\s+/);
        if(parts.length!==6)return false;
        const turn=parts[1], castling=parts[2], ep=parts[3], half=parts[4], full=parts[5];
        if(!/^(w|b)$/.test(turn))return false;
        if(!/^([KQkq]+|-)$/.test(castling))return false;
        if(!/^(-|[a-h][36])$/.test(ep))return false;
        if(Number.isNaN(Number(half))||Number.isNaN(Number(full)))return false;
        return /^[prnbqkPRNBQK1-8/]+$/.test(parts[0]);
      };
      const sanitizeFen=(fen,ChessCtor)=>{
        try{ if(!isValidFenLike(fen))return 'start'; if(!ChessCtor)return 'start'; new ChessCtor(fen); return fen; }
        catch{ return 'start'; }
      };

      const OPENINGS={dutch:{label:'Dutch Defense (Black)',side:'black',levels:[{name:'Intermediate',lessons:[{id:'dutch-intro-classical',title:'Classical setup vs 1.d4',description:'Solid classical move-order leading to quick castling and control of e4.',san:['d4','f5','c4','Nf6','Nc3','e6','Nf3','Be7','g3','O-O']}]},{name:'Advanced Beginner',lessons:[{id:'dutch-stonewall-skeleton',title:'Stonewall skeleton',description:'The Stonewall structure: d5–e6–f5–c6 with harmonious development.',san:['d4','f5','c4','Nf6','Nc3','e6','Nf3','d5','e3','c6','Bd3','Bd6','O-O','O-O']}]},{name:'Club Player',lessons:[{id:'dutch-leningrad-starter',title:'Leningrad starter',description:'Aggressive kingside fianchetto aiming for space and attacks on the king.',san:['d4','f5','g3','Nf6','Bg2','g6','c4','Bg7','Nc3','O-O','Nf3','d6','O-O','Qe8']}]},{name:'Expert',lessons:[{id:'dutch-e5-break',title:'…e5 central break plan',description:'Typical classical plan: prepare …e5 to challenge White’s center at the right moment.',san:['d4','f5','c4','Nf6','Nc3','e6','Nf3','d6','g3','Be7','Bg2','O-O','O-O','Qe8','Qc2','e5','dxe5','dxe5']}]},{name:'Grandmaster',lessons:[{id:'dutch-vs-staunton',title:'Vs Staunton Gambit (2.e4)',description:'A calm antidote to the Staunton: solidify and develop without panic.',san:['d4','f5','e4','fxe4','Nc3','Nf6','Bg5','c6','f3','d5','fxe4','dxe4','Bc4','Bf5']}]}]},vienna:{label:'Vienna Opening (White)',side:'white',levels:[{name:'Intermediate',lessons:[{id:'vienna-classical',title:'Classical Vienna setup',description:'Flexible development with options to transpose to Italian-like structures.',san:['e4','e5','Nc3','Nf6','Nf3','Nc6','Bc4','Bc5','d3','d6','O-O','O-O']}]},{name:'Advanced Beginner',lessons:[{id:'vienna-gambit-main',title:'Vienna Gambit: main ideas',description:'Sacrifice a pawn for rapid development and pressure on f7 and the e-file.',san:['e4','e5','Nc3','Nf6','f4','d5','fxe5','Nxe4','Qf3','Nc6','Bb5','Nxc3','dxc3']}]},{name:'Club Player',lessons:[{id:'vienna-qf3-plan',title:'Qf3 plan vs …Bg4',description:'Model attacking plan: central buildup, Qe1–Qg3 motifs against the king.',san:['e4','e5','Nc3','Nf6','f4','Nc6','Nf3','d6','Bc4','Be7','d3','O-O','O-O','Bg4','Qe1','Qd7','Qg3']}]},{name:'Expert',lessons:[{id:'vienna-four-knights',title:'Vienna → Four Knights',description:'Sound development with clear piece play; a great practical weapon.',san:['e4','e5','Nc3','Nc6','Nf3','Nf6','Bb5','Bb4','O-O','O-O','d3','d6']}]},{name:'Grandmaster',lessons:[{id:'vienna-g3-quite',title:'Quiet g3 system',description:'A positional line that keeps options flexible while neutralizing …d5 ideas.',san:['e4','e5','Nc3','Nf6','g3','d5','exd5','Nxd5','Bg2','Be6','Nf3','Nc6','O-O']}]}]}};

      function ErrorBox({children}){
        if(!children)return null;
        return React.createElement('div',{style:{marginTop:12,padding:12,borderRadius:8,border:'1px solid rgba(239,68,68,.4)',background:'rgba(239,68,68,.1)',color:'#fecaca',fontSize:14}},children);
      }

      function App(){
        const [depError,setDepError]=useState('');
        useEffect(()=>{
          const e=[]; if(!Chess)e.push('chess.js not detected: expected a Chess constructor export');
          if(!Chessboard)e.push('react-chessboard not detected: expected a React component export');
          setDepError(e.join(' • '));
        },[]);

        const [openingKey,setOpeningKey]=useState('dutch');
        const [levelIdx,setLevelIdx]=useState(0);
        const [lessonIdx,setLessonIdx]=useState(0);
        const [freePlay,setFreePlay]=useState(false);
        const [status,setStatus]=useState('');
        const [showHint,setShowHint]=useState(false);
        const [correctCount,setCorrectCount]=useState(0);
        const [attempts,setAttempts]=useState(0);
        const [autoAdvance,setAutoAdvance]=useState(true);
        const [error,setError]=useState('');
        const [testReport,setTestReport]=useState(null);

        const opening=OPENINGS[openingKey]; const level=opening.levels[levelIdx]; const lesson=level.lessons[lessonIdx];
        const userColor=opening.side==='white'?'w':'b'; const orientation=opening.side;

        const [game,setGame]=useState(()=>{
          try{ if(!Chess)throw new Error('no engine'); const g=new Chess(); const fen=g.fen();
            if(!isValidFenLike(fen))throw new Error('Engine produced invalid FEN at init'); return g;
          }catch{ return {fen:()=> 'start',turn:()=> 'w',moves:()=>[],move:()=>null}; }
        });

        const [ply,setPly]=useState(0); const expectedSAN=lesson.san[ply]; const boardRef=useRef(null);

        const syncToUserTurn=(g,startPly=0)=>{
          let p=startPly; const turnIsUser=()=>g.turn()===userColor;
          while(p<lesson.san.length&&!turnIsUser()){ const made=g.move(lesson.san[p]); if(!made)break; p++; }
          return{g,localPly:p};
        };

        const expectedMoveVerbose=useMemo(()=>{
          if(!expectedSAN||!Chess)return null;
          try{ const fen=game.fen(); const clone=new Chess(sanitizeFen(fen,Chess));
            if(clone.turn()!==userColor)return null; const list=clone.moves({verbose:true});
            return list.find(m=>stripChecks(m.san)===stripChecks(expectedSAN))||null;
          }catch{ return null; }
        },[game,expectedSAN,userColor]);

        const resetLesson=()=>{
          setError('');
          try{ if(!Chess)throw new Error('Chess engine unavailable');
            const fresh=new Chess(); const tmp=syncToUserTurn(fresh,0); const g=tmp.g, localPly=tmp.localPly;
            const fen=g.fen(); const safeFen=sanitizeFen(fen,Chess);
            if(safeFen==='start'&&fen!=='start')throw new Error('Invalid FEN after reset');
            setGame(g); setPly(localPly); setStatus("Start the line by playing the correct move when it's your turn."); setShowHint(false);
          }catch(e){ setError('Reset failed: ' + (e && e.message ? e.message : e)); }
        };
        useEffect(()=>{resetLesson();},[openingKey,levelIdx,lessonIdx]);

        const autoPlayOpponent=(g,curPly)=>{
          let p=curPly; const turnIsUser=()=>g.turn()===userColor;
          while(p<lesson.san.length&&!turnIsUser()){ const san=lesson.san[p]; const made=g.move(san); if(!made)break; p++; }
          return p;
        };

        const onDrop=(sourceSquare,targetSquare)=>{
          setError('');
          if(!Chess){ setError('Chess engine unavailable.'); return false; }
          let g;
          try{ const fen=game.fen(); const safeFen=sanitizeFen(fen,Chess); g=new Chess(safeFen); }
          catch(e){ setError('Failed to clone position: ' + (e && e.message ? e.message : e)); return false; }

          if(freePlay){
            const move=g.move({from:sourceSquare,to:targetSquare,promotion:'q'});
            if(move){
              const opp=g.moves({verbose:true});
              if(opp.length&&g.turn()!==userColor){ const random=opp[Math.floor(Math.random()*opp.length)]; g.move(random); }
              setGame(g); return true;
            }
            return false;
          }

          if(g.turn()!==userColor){
            setStatus("It's not your move yet — the opponent needs to play.");
            const nextPly=autoPlayOpponent(g,ply); if(nextPly!==ply){ setPly(nextPly); setGame(g); } return false;
          }

          const attempt=g.move({from:sourceSquare,to:targetSquare,promotion:'q'});
          if(!attempt)return false;
          setAttempts(function(a){return a+1;});

          if(stripChecks(attempt.san)!==stripChecks(expectedSAN)){
            setStatus('❌ Not the scripted move ('+attempt.san+'). Try again or toggle Free Play.');
            return false;
          }

          let nextPly=ply+1; setCorrectCount(function(c){return c+1;}); nextPly=autoPlayOpponent(g,nextPly);
          setGame(g); setPly(nextPly);
          if(nextPly>=lesson.san.length){ setStatus('✅ Line complete! Great job.'); if(autoAdvance)setTimeout(function(){goToNextLesson();},300); }
          else { setStatus('✅ Correct. Keep following the line.'); }
          return true;
        };

        const goToPrevLesson=()=>{
          if(lessonIdx>0){ setLessonIdx(lessonIdx-1); }
          else if(levelIdx>0){ setLevelIdx(levelIdx-1); setLessonIdx(OPENINGS[openingKey].levels[levelIdx-1].lessons.length-1); }
        };
        const goToNextLesson=()=>{
          const n=OPENINGS[openingKey].levels[levelIdx].lessons.length;
          if(lessonIdx<n-1){ setLessonIdx(lessonIdx+1); }
          else if(levelIdx<OPENINGS[openingKey].levels.length-1){ setLevelIdx(levelIdx+1); setLessonIdx(0); }
          else { setStatus('All lessons done for this opening! Try the other opening or Free Play.'); }
        };
        const autoplayAll=()=>{
          setError('');
          try{ if(!Chess)throw new Error('Chess missing'); const g=new Chess(); let i=0;
            while(i<lesson.san.length){ const made=g.move(lesson.san[i]); if(!made)break; i++; }
            setGame(g); setPly(i); if(i>=lesson.san.length)setStatus('Preview finished. Reset to drill moves yourself.');
          }catch(e){ setError('Autoplay failed: ' + (e && e.message ? e.message : e)); }
        };

        const customSquareStyles=useMemo(()=>{
          if(!Chess)return {};
          let clone; try{ clone=new Chess(sanitizeFen(game.fen(),Chess)); } catch{return {};}
          if(!showHint||!expectedMoveVerbose||clone.turn()!==userColor)return {};
          const hl={ boxShadow:'inset 0 0 0 3px rgba(234, 179, 8, 0.9)', outline:'2px solid rgba(234,179,8,0.6)' };
          const obj={}; obj[expectedMoveVerbose.from]=hl; obj[expectedMoveVerbose.to]=hl; return obj;
        },[showHint,expectedMoveVerbose,game,userColor]);

        const safePosition=useMemo(()=>{
          try{ return sanitizeFen(game.fen(),Chess); } catch { return 'start'; }
        },[game]);

        const layout={section:{padding:16,borderRadius:16,border:'1px solid rgba(255,255,255,.08)',background:'rgba(255,255,255,.04)'}};

        const [progress,setProgress]=useState(0);
        useEffect(()=>{ setProgress(Math.min(100,Math.round((ply/lesson.san.length)*100))); },[ply,lesson.san.length]);

        const runSelfTests=async()=>{
          const results=[];
          results.push({name:'Deps: chessboard present',ok:!!Chessboard,detail:String(!!Chessboard)});
          results.push({name:'Deps: Chess constructor present',ok:!!Chess,detail:String(!!Chess)});
          try{ if(!Chess)throw new Error('Chess missing'); const g=new Chess(); const fen=g.fen();
            results.push({name:'Chess() constructor / FEN',ok:isValidFenLike(fen),detail:fen});
          }catch(e){ results.push({name:'Chess() constructor / FEN',ok:false,detail:(e&&e.message)?e.message:String(e)}); }
          results.push({name:'FEN validator (invalid sample)',ok:!isValidFenLike('invalid fen'),detail:'Expect false'});
          results.push({name:'FEN validator (start sentinel)',ok:!isValidFenLike('start'),detail:"'start' is UI sentinel"});

          Object.entries(OPENINGS).forEach(function(entry){
            var course = entry[1];
            (course.levels||[]).forEach(function(L){
              (L.lessons||[]).forEach(function(les){
                try{
                  if(!Chess)throw new Error('Chess missing');
                  var g2=new Chess(); var i=0;
                  for(;i<les.san.length;i++){
                    var made=g2.move(les.san[i]);
                    if(!made) throw new Error('Illegal SAN at ply ' + (i+1) + ': ' + les.san[i]);
                  }
                  results.push({name: (course.label + ' • ' + L.name + ' • ' + les.title), ok:true, detail: ('Moves: ' + i)});
                }catch(e){
                  results.push({name: (course.label + ' • ' + L.name + ' • ' + les.title), ok:false, detail: ((e&&e.message)?e.message:String(e))});
                }
              });
            });
          });
          return results;
        };

        return React.createElement('div',{style:{minHeight:'100vh',padding:24,background:'linear-gradient(to bottom, #0f172a, #020617)'}},
          React.createElement('div',{style:{maxWidth:1200,margin:'0 auto'}},
            React.createElement('header',{style:{display:'flex',gap:16,justifyContent:'space-between',alignItems:'flex-end',flexWrap:'wrap'}},
              React.createElement('div',null,
                React.createElement('h1',{style:{fontSize:28,fontWeight:800,margin:0}},'Opening Trainer: ',React.createElement('span',{style:{color:'#fbbf24'}},'Dutch'),' & ',React.createElement('span',{style:{color:'#38bdf8'}},'Vienna')),
                React.createElement('p',{style:{marginTop:6,color:'#cbd5e1'}},'Follow the scripted lines. Your goal is to play the correct move at each turn for your side.')
              ),
              React.createElement('div',{style:{display:'flex',gap:8}},
                React.createElement('button',{onClick:function(){setOpeningKey(openingKey==='dutch'?'vienna':'dutch');},style:{padding:'8px 12px',borderRadius:10,background:'rgba(255,255,255,.08)',border:'1px solid rgba(255,255,255,.18)'}},'Switch to ',(openingKey==='dutch'?'Vienna (White)':'Dutch (Black)')),
                React.createElement('button',{onClick:function(){setFreePlay(function(f){return !f;});},'aria-label':'toggle-free-play',style:{padding:'8px 12px',borderRadius:10,border:'1px solid',borderColor:(freePlay?'#10b981':'rgba(255,255,255,.18)'),background:(freePlay?'#10b981':'rgba(255,255,255,.08)'),color:(freePlay?'white':'inherit')}},(freePlay?'Free Play: ON':'Free Play: OFF'))
              )
            ),
            React.createElement(ErrorBox,null,depError||error),
            React.createElement('div',{style:{display:'grid',gridTemplateColumns:'1fr',gap:24,marginTop:24}},
              React.createElement('div',{style:{display:'grid',gridTemplateColumns:'1fr',gap:24}},
                React.createElement('div',{style:layout.section},
                  React.createElement('h2',{style:{margin:0,fontSize:18}},'Opening & Level'),
                  React.createElement('div',{style:{marginTop:8,display:'flex',gap:12,flexWrap:'wrap'}},React.createElement('span',{style:{fontSize:12,padding:'4px 8px',borderRadius:8,background:'rgba(255,255,255,.08)',border:'1px solid rgba(255,255,255,.12)'}},OPENINGS[openingKey].label)),
                  React.createElement('div',{style:{marginTop:12,display:'flex',gap:8,flexWrap:'wrap'}},
                    opening.levels.map(function(L,idx){return React.createElement('button',{key:L.name,onClick:function(){setLevelIdx(idx);setLessonIdx(0);},style:{padding:'6px 10px',borderRadius:999,fontSize:12,border:'1px solid',background:(idx===levelIdx?'#f59e0b':'rgba(255,255,255,.08)'),color:(idx===levelIdx?'white':'inherit'),borderColor:(idx===levelIdx?'#f59e0b':'rgba(255,255,255,.18)')}},(idx+1)+'. '+L.name);})
                  ),
                  React.createElement('div',{style:{marginTop:10,display:'flex',gap:8,flexWrap:'wrap'}},
                    level.lessons.map(function(les,idx){return React.createElement('button',{key:les.id,onClick:function(){setLessonIdx(idx);},style:{padding:'6px 10px',borderRadius:8,fontSize:12,border:'1px solid',background:(idx===lessonIdx?'#0ea5e9':'rgba(255,255,255,.08)'),color:(idx===lessonIdx?'white':'inherit'),borderColor:(idx===lessonIdx?'#0ea5e9':'rgba(255,255,255,.18)')}},les.title);})
                  )
                ),
                React.createElement('div',{style:layout.section},
                  React.createElement('h3',{style:{margin:0}},'Lesson'),
                  React.createElement('p',{style:{marginTop:6,color:'#cbd5e1',fontSize:14}},lesson.title),
                  React.createElement('p',{style:{marginTop:6,color:'#94a3b8',fontSize:13}},lesson.description),
                  React.createElement('div',{style:{marginTop:10,display:'flex',gap:8,flexWrap:'wrap',alignItems:'center'}},
                    React.createElement('button',{onClick:resetLesson,style:{padding:'8px 12px',borderRadius:10,background:'rgba(255,255,255,.08)',border:'1px solid rgba(255,255,255,.18)'}},'Reset'),
                    React.createElement('button',{onClick:autoplayAll,style:{padding:'8px 12px',borderRadius:10,background:'rgba(255,255,255,.08)',border:'1px solid rgba(255,255,255,.18)'}},'Auto-play line'),
                    React.createElement('button',{onClick:function(){ if(lessonIdx>0)setLessonIdx(lessonIdx-1); else if(levelIdx>0){ setLevelIdx(levelIdx-1); setLessonIdx(OPENINGS[openingKey].levels[levelIdx-1].lessons.length-1);}},style:{padding:'8px 12px',borderRadius:10,background:'rgba(255,255,255,.08)',border:'1px solid rgba(255,255,255,.18)'}},'◀ Prev'),
                    React.createElement('button',{onClick:function(){ const n=OPENINGS[openingKey].levels[levelIdx].lessons.length; if(lessonIdx<n-1)setLessonIdx(lessonIdx+1); else if(levelIdx<OPENINGS[openingKey].levels.length-1){ setLevelIdx(levelIdx+1); setLessonIdx(0);} else setStatus('All lessons done for this opening! Try the other opening or Free Play.');},style:{padding:'8px 12px',borderRadius:10,background:'rgba(255,255,255,.08)',border:'1px solid rgba(255,255,255,.18)'}},'Next ▶'),
                    React.createElement('button',{onClick:function(){setShowHint(function(h){return !h;});},style:{padding:'8px 12px',borderRadius:10,border:'1px solid',borderColor:(showHint?'#f59e0b':'rgba(255,255,255,.18)'),background:(showHint?'#f59e0b':'rgba(255,255,255,.08)'),color:(showHint?'black':'inherit')}},(showHint?'Hide Hint':'Show Hint')),
                    React.createElement('label',{style:{marginLeft:'auto',display:'flex',gap:6,alignItems:'center',fontSize:12}},React.createElement('input',{type:'checkbox',checked:autoAdvance,onChange:function(e){setAutoAdvance(e.target.checked);}}),'Auto-advance lessons')
                  ),
                  React.createElement('div',{style:{marginTop:12}},
                    React.createElement('div',{style:{height:8,width:'100%',background:'rgba(255,255,255,.1)',borderRadius:999,overflow:'hidden'}},
                      React.createElement('div',{style:{height:'100%',width:(String(Math.min(100,Math.round((ply/lesson.san.length)*100)))+'%'),background:'#fbbf24'}})
                    ),
                    React.createElement('div',{style:{marginTop:6,fontSize:12,color:'#94a3b8'}},'Progress: '+ply+'/'+lesson.san.length+' • Correct moves: '+correctCount+' / Attempts: '+attempts)
                  )
                ),
                React.createElement('div',{style:layout.section},
                  React.createElement('h3',{style:{margin:0}},'Scripted Line (SAN)'),
                  React.createElement('div',{style:{marginTop:8,fontSize:13,padding:12,borderRadius:10,background:'rgba(0,0,0,.3)',border:'1px solid rgba(255,255,255,.12)'}},
                    lesson.san.map(function(m,i){
                      const moveNo=Math.floor(i/2)+1; const isWhite=i%2===0; const marker=(i===ply?' ⟵ next':'');
                      return React.createElement('span',{key:i,style:{color:(i===ply?'#fbbf24':'inherit')}},(isWhite? (moveNo+'. ') : ''),m,(i<lesson.san.length-1?' ':''),marker);
                    })
                  )
                ),
                React.createElement('div',{style:layout.section},
                  React.createElement('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center'}},
                    React.createElement('h3',{style:{margin:0}},'Self-tests'),
                    React.createElement('button',{onClick:async function(){ setTestReport(await runSelfTests()); },style:{padding:'8px 12px',borderRadius:10,background:'rgba(255,255,255,.08)',border:'1px solid rgba(255,255,255,.18)'}},'Run tests')
                  ),
                  testReport && React.createElement('div',{style:{marginTop:8,fontSize:12}},
                    testReport.map(function(r,idx){
                      return React.createElement('div',{key:idx,style:{marginTop:6,padding:8,borderRadius:8,border:('1px solid '+(r.ok?'rgba(16,185,129,.4)':'rgba(239,68,68,.4)')),background:(r.ok?'rgba(16,185,129,.1)':'rgba(239,68,68,.1)'),color:(r.ok?'#bbf7d0':'#fecaca')}},
                        React.createElement('div',{style:{fontFamily:'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas'}},(r.ok?'PASS':'FAIL'),' — ',r.name),
                        React.createElement('div',{style:{opacity:.8,wordBreak:'break-word'}},r.detail)
                      );
                    })
                  )
                )
              ),
              React.createElement('div',{style:layout.section},
                React.createElement('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:12}},
                  React.createElement('div',null,React.createElement('div',{style:{fontSize:12,textTransform:'uppercase',letterSpacing:.08,color:'#94a3b8'}},'Your side'),React.createElement('div',{style:{fontSize:18,fontWeight:600}},opening.side.toUpperCase())),
                  React.createElement('div',{style:{textAlign:'right'}},React.createElement('div',{style:{fontSize:12,color:'#94a3b8'}},'Expected next move'),React.createElement('div',{style:{fontFamily:'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas'}},(userColor===game.turn()?(expectedSAN||'—'):'(opponent)')))
                ),
                React.createElement('div',{style:{maxWidth:560,margin:'0 auto'}},
                  (Chessboard? React.createElement(Chessboard,{id:'trainer-board',animationDuration:150,position:safePosition,boardOrientation:orientation,onPieceDrop:onDrop,customBoardStyle:{borderRadius:16,boxShadow:'0 8px 30px rgba(0,0,0,0.5)'},customSquareStyles:customSquareStyles,arePiecesDraggable:true,boardWidth:560,ref:boardRef})
                   : React.createElement('div',{style:{padding:12,fontSize:14,color:'#fecaca',border:'1px solid rgba(239,68,68,.4)',borderRadius:8,background:'rgba(239,68,68,.1)'}},'Chessboard component unavailable.'))
                ),
                React.createElement('div',{style:{marginTop:12,fontSize:14,minHeight:24}},status),
                React.createElement('div',{style:{marginTop:8,fontSize:12,color:'#94a3b8'}},'Tip: Toggle ',React.createElement('span',{style:{color:'#fbbf24'}},'Free Play'),' to experiment — a random opponent reply will be chosen.')
              ),
              React.createElement('footer',{style:{marginTop:24,textAlign:'center',fontSize:12,color:'#64748b'}},'Built for coaching patterns: correctness over creativity. Switch openings at the top and progress through levels.')
            )
          )
        );
      }

      createRoot(document.getElementById('root')).render(React.createElement(App));
    </script>
  </body>
</html>
