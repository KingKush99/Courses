<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Rugby — SRS</title>
  <link rel="stylesheet" href="../assets/base.css">
  <script defer src="../assets/app.js"></script>
</head>
<body>
<main class="wrap">
  <section class="card">
    <h2>Spaced Repetition</h2>
    <div id="qa"></div>
    <div class="hud">
      <button class="pill-btn sm" data-g="1">Again (1)</button>
      <button class="pill-btn sm" data-g="2">Hard (2)</button>
      <button class="pill-btn sm" data-g="3">Good (3)</button>
      <button class="pill-btn sm" data-g="4">Easy (4)</button>
      <span class="badge" id="due"></span>
      <a class="pill-btn sm" id="hint">? Hint</a>
      <a class="pill-btn sm" id="src">👁 Source</a>
    </div>
  </section>
</main>
<script>
const bankUrl='data/bank.json';
const storeKey='rugby_srs_v1';
const now=()=>Date.now();
let deck=[], progress=JSON.parse(localStorage.getItem(storeKey)||'{}');
function pickNext(){ const due=deck.filter(q=>!progress[q.id] || (progress[q.id].due||0)<=now()); document.getElementById('due').textContent=`Due: ${due.length}`; return (due.length? due : deck)[0];}
function render(q){
  const qa=document.getElementById('qa');
  qa.innerHTML=`<h3>${q.q}</h3><p class="badge">Answer: <b>${q.a}</b></p>`;
  document.getElementById('hint').onclick=()=>alert(q.hint||'Study the PDFs for clues.');
  document.getElementById('src').onclick=()=>alert(q.src||'See team PDFs.');
  document.querySelectorAll('[data-g]').forEach(b=>b.onclick=()=>grade(q,parseInt(b.dataset.g,10)));
}
function grade(q,g){
  const st=progress[q.id]||{ease:2.5, interval:0, reps:0};
  let interval=1*60*1000;
  if(g<=1){ interval=1*60*1000; st.reps=0; }
  else if(g==2){ interval=10*60*1000; st.reps=0; }
  else if(g==3){ interval=60*60*1000; st.reps=(st.reps||0)+1; }
  else { interval=4*24*60*60*1000; st.reps=(st.reps||0)+1; }
  const due=Date.now()+interval;
  progress[q.id]={interval,due,reps:st.reps};
  localStorage.setItem(storeKey,JSON.stringify(progress));
  updateCoins(2);
  render(pickNext());
}
fetch(bankUrl).then(r=>r.json()).then(data=>{deck=data.items; render(pickNext());});
</script>
</body>
</html>